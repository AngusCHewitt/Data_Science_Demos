library("modelr")
library("tidyverse")
library("gapminder")
lifeExp ~ poly(year, 2)
# Fit many lienar models
country_model <- function(df) {
lm(lifeExp ~ poly(year - median(year), 2), data = df)
}
Mod_Quality <- function(df) {
Mod_AIC <- AIC(logLik(df))
}
gapminder %>%
group_by(country, continent) %>%
nest() %>%
mutate(model = map(data, country_model))  %>%
mutate(Log_AIC = map(model, Mod_Quality)) -> by_country
by_country
by_country <- by_country %>%
mutate(
resids = map2(data, model, add_residuals)
)
by_country
unnest(by_country, resids) %>%
ggplot(aes(year, resid)) +
geom_line(aes(group = country), alpha = 1 / 3) +
geom_smooth(se = FALSE)
by_country %>%
mutate(glance = map(model, broom::glance)) %>%
unnest(glance, .drop = TRUE) %>%
ggplot(aes(continent, r.squared)) +
geom_jitter(width = 0.5)
library("ggbeeswarm")
by_country %>%
mutate(glance = map(model, broom::glance)) %>%
unnest(glance, .drop = TRUE) %>%
ggplot(aes(continent, r.squared)) +
geom_beeswarm()
install.packages("ggbeeswarm")
library("ggbeeswarm")
by_country %>%
mutate(glance = map(model, broom::glance)) %>%
unnest(glance, .drop = TRUE) %>%
ggplot(aes(continent, r.squared)) +
geom_beeswarm()
gapminder %>%
group_by(country, continent) %>%
nest() %>%
mutate(model = map(data, ~lm(lifeExp ~ year, .))) %>%
mutate(glance = map(model, broom::glance)) %>%
unnest(glance) %>%
unnest(data) %>%
filter(r.squared < 0.25) %>%
ggplot(aes(year, lifeExp)) +
geom_line(aes(color = country))
library(readxl)
Nov_VEMD_data_Emerg_factor_analysis <- read_excel("~/OneDrive - Department of Health and Human Services. Victoria/ED factor analysis/Nov VEMD data Emerg factor analysis.xlsx",
sheet = "Sheet3", col_types = c("text",
"text", "text", "text", "text", "text",
"text", "text", "text", "numeric",
"numeric"))
View(Nov_VEMD_data_Emerg_factor_analysis)
summary(Nov_VEMD_data_Emerg_factor_analysis)
Nov_VEMD_dt <- read_excel("~/OneDrive - Department of Health and Human Services. Victoria/ED factor analysis/Nov VEMD data Emerg factor analysis.xlsx",
sheet = "Sheet3", col_types = c("text", "text", "text", "text", "text", "text", "text", "text", "text", "numeric",  "numeric"))
unique(Nov_VEMD_dt$Hospital)
length(unique(Nov_VEMD_dt$Hospital))
table(Nov_VEMD_dt $`Type Of Visit`)
table(Nov_VEMD_dt $Arr Transp Mode )
table(Nov_VEMD_dt$`Arr Transp Mode`)
table(Nov_VEMD_dt$`Primary Care Type v2`)
table(Nov_VEMD_dt$`Dep Stat`)
table(Nov_VEMD_dt$`Triage Cat Cd`)
table(Nov_VEMD_dt$`Age Groupings 0-14 15-64 65-74 75-84 85`)
table(Nov_VEMD_dt$`Meets Criteria As MH Patient v2`)
levels(Nov_VEMD_dt$`Dep Stat`)
level(as.factor(Nov_VEMD_dt$`Dep Stat`))
levels(as.factor(Nov_VEMD_dt$`Dep Stat`))
length(levels(as.factor(Nov_VEMD_dt$`Dep Stat`)))
