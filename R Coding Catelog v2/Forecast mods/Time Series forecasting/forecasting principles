##-- Testing Tableau calc tables --##

library(forecast)


# stablise seasonality with natrual logs and autoforecast  
  data <- forecast(log(AirPassengers)
  f.ts <- exp(data$mean)
  
# visual actuals and forecast  
  plot(data)
  autoplot(AirPassengers) + autolayer(f.ts)

#  AirPassengers csv file written to directory
  write.csv(AirPassengers,"AirPassenger.csv")

# test code used to calc tableau tabels
  data <- data.frame(Passenger=AirPassengers)

# num is replaced with .arg1 in Tableau
  num <- 1:30
  data <- diff(cbind(num));cbind(c(NA,data[,1],0))
  
  
#-- forecast the log of AirPassengers --#
  
  library(forecast)
  data <- data.frame(Passenger=AirPassengers)
  logAP <- log(as.vector(data))
  fcast <- forecast(logAP$Passenger);exp(as.vector(fcast$mean))
  
  attributes(as.vector(fcast$mean))
  for
  
  names(fcast)
  
# forecast a stationary t.s. - % diffs
  
# derive % diffs of AP
  plot(AirPassengers/stats::lag(AirPassengers,-1) - 1)
  
# create an objert for % diffs
  Per_diff <- AirPassengers/stats::lag(AirPassengers,-1) - 1
  
# Project % Differences
  fcast_diff <- forecast(Per_diff)
  
  
#-- cross validation of % diff method --#
  
  training_ds <- window(AirPassengers,end=c(1958,12))
  test_ds <- window(AirPassengers,start=c(1959,1))
  
  plot(training_ds/stats::lag(training_ds,-1) - 1)
  
# create an objert for % diffs
  Per_diff <- training_ds/stats::lag(training_ds,-1) - 1
  
# Project % Differences
  fcast_diff <- forecast(Per_diff)
  
  plot(fcast_diff)
  
#-- cross validation of diff method --#
  
 plot(diff(training_ds))
 
 plot(forecast(diff(training_ds)))
 
 fcast_diff <- forecast(diff(training_ds))
 
 checkresiduals( fcast_diff)
   
   #-- cross validation oflog method --#
  
 plot(log(training_ds))
 
 plot(forecast(log(training_ds)))
 
 fcast_diff_log <- forecast(log(training_ds))
 
 exp_fcast <- exp(fcast_diff_log$mean) 
 
 accuracy(exp_fcast,test_ds)